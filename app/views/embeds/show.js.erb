var widgetVal = "<%= @domain.id %>";
var currentCookie = getCookie("survWidget");

function getCookie(c_name) {
  if (document.cookie.length > 0) {
    c_start = document.cookie.indexOf(c_name + "=");
    if (c_start != -1) {
      c_start = c_start + c_name.length + 1;
      c_end = document.cookie.indexOf(";", c_start);
      if (c_end == -1) {
        c_end = document.cookie.length;
      }
      return unescape(document.cookie.substring(c_start, c_end));
    }
  }
  return "";
}

function loadWidgetScript() {
  document.write("<%= escape_javascript(render(:partial => 'embeds/widget_js')).html_safe %>");
}

if ( widgetVal != currentCookie ) {
  if ( 'querySelector' in document && 'addEventListener' in window && Array.prototype.forEach ) {
    document.write("<%= escape_javascript(render(:partial => 'embeds/widget_css')).html_safe %>");
    document.write("<%= escape_javascript(render(:partial => 'embeds/widget_markup')).html_safe %>");
    if ( window.jQuery ) {
      loadWidgetScript();
    } else {
      document.write("<script src='http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js'></script>");
      loadWidgetScript();
    }
  }
}